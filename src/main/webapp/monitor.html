<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title></title>
    <link href="static/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="static/css/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">

    <link rel="stylesheet" href="static/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="static/css/bootstrap-table.css">

</head>
<body>

<hr>

<div class="container">
    <div class="row">
        <div class="col-md-8" align="right">
            <label for="datetime" class="col-md-10 control-label">选择查询时间：</label>
            <div class="input-group date form_date col-md-8 col-lg-4" data-date="" data-date-format="yyyy-mm-dd" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                <input class="form-control" id="datetime" size="16" type="text" value="" readonly>
                <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
            </div>
        </div>
        <div class="col-md-2">
            <label for="device" class="col-md-8 control-label">选择设备：</label>
            <select class="form-control col-md-8"  id="device">
                <option>PL</option>
                <option>DS</option>
                <!--<option>ALL</option>-->
            </select>
        </div>
        <div class="col-md-2" >
            <button class="btn btn-lg btn-primary btn-block" id="query">查询</button>
        </div>
    </div>

    <hr>

</div>
<p id="myDiv"></p>
<div class="container">
    <table id="table"
           data-toolbar="#toolbar"
           data-search="true"
           data-show-refresh="true"
           data-show-toggle="true"
           data-show-columns="true"
           data-show-export="true"
           data-detail-view="true"
           data-detail-formatter="detailFormatter"
           data-minimum-count-columns="2"
           data-show-pagination-switch="true"
           data-pagination="true"
           data-id-field="id"
           data-page-list="[10, 25, 50, 100, ALL]"
           data-show-footer="false"
           data-side-pagination="client"
           data-response-handler="responseHandler">
    </table>
</div>

<script type="text/javascript" src="static/jquery/jquery-3.2.1.min.js" charset="UTF-8"></script>
<script type="text/javascript" src="static/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="static/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<script type="text/javascript" src="static/js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>

<script src="static/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
<script src="static/js/bootstrap-table.min.js"></script>
<script src="static/js/locales/bootstrap-table-zh-CN.min.js"></script>
<script type="text/javascript">
    $('.form_date').datetimepicker({
        language: 'zh-CN',
        weekStart: 1,
        todayBtn: 1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView: 2,
        forceParse: 0
    });
    $('#datetime').val(nowtime());
    $('.form_date').datetimepicker('update');
    //document.getElementById('query').addEventListener('click', function() {
        //console.log($("#datetime").val());
        /*var datetime = $("#datetime").val()+" 00:00:00";
        var device = $("#device").val();
        var xmlhttp=new XMLHttpRequest();

        xmlhttp.onreadystatechange=function()
        {
            if (xmlhttp.readyState==4 && xmlhttp.status==200)
            {
                document.getElementById("myDiv").innerHTML=xmlhttp.responseText;
                //console.log(xmlhttp.responseText);
                var result = toJson(xmlhttp.responseText);
                var jlength = result.length;

                for (var i = 0; i < jlength; i++) {
                    //result[i]表示获得第i个json对象即JSONObject
                    //result[i]通过.字段名称即可获得指定字段的值
                    var a = result[i].length1;
                }

                console.log(j);
                console.log(xmlhttp.responseText);

            }
        }

        xmlhttp.open("GET","/MiddlewareWeb/"+device+"/"+device+"ResultByTime?"+"time="+datetime,true);
        xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
        xmlhttp.send();*/

        //console.log($("#device").val());
        //window.myLine.update();

    //});

    /*function toJson(str){
        return JSON.parse(str);
    }*/
    function nowtime(){//将当前时间转换成yyyymmdd格式
        var mydate = new Date();
        var str = "" + mydate.getFullYear()+"-";
        var mm = mydate.getMonth()+1
        if(mydate.getMonth()>9){
            str += mm+"-";
        }
        else{
            str += "0" + mm+"-";
        }
        if(mydate.getDate()>9){
            str += mydate.getDate();
        }
        else{
            str += "0" + mydate.getDate();
        }
        return str;
    }

    $(function(){
        $("#query").click(function () {
            var datetime = $("#datetime").val()+" 00:00:00";
            var device = $("#device").val();

            $.ajax({
                type: "GET",
                url: "/MiddlewareWeb/"+device+"/"+device+"ResultByTime?"+"time="+datetime,
                dataType: "html",
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                success: function (msg) {
                    var jsonText = JSON.parse(msg);
                    //document.getElementById("myDiv").innerHTML=msg;
                    var key;
                    var rows = [];
                    for (key in jsonText) {
                        if (jsonText.hasOwnProperty(key)) {
                            var value = jsonText[key];
                            for (var i = 0; i < value.length; i++) {
                                //data[i]表示获得第i个json对象即JSONObject
                                //data[i]通过.字段名称即可获得指定字段的值
                                console.log(value[i].fullName);
                                rows.push({
                                    barCode: value[i].barCode,
                                    sampleId: value[i].sampleId,
                                    fullName: value[i].fullName,
                                    patientId: value[i].patientId,
                                    sex: value[i].sex,
                                    device: value[i].device,
                                    sampleKind: value[i].sampleKind,
                                    testTime: value[i].testTime
                                });
                            }
                        }
                    }
                    //var a ="{\"aap\":\"23\",\"barCode\":\"2323\",\"fullName\":\"和我\"}";
                    $('#table').bootstrapTable('load',rows);

                },
                error: function () {
                    alert("error");
                }
            });
        });

        /*$("#data").click(function(){

        });*/
    });


    $('#table').bootstrapTable({
        columns: [{
            field: 'barCode',
            title: '编号'
        }, {
            field: 'sampleId',
            title: '样本 ID'
        }, {
            field: 'patientId',
            title: '病人 ID'
        }, {
            field: 'fullName',
            title: '病人姓名'
        }, {
            field: 'sex',
            title: '性别'
        }, {
            field: 'device',
            title: '测试仪器'
        }, {
            field: 'sampleKind',
            title: '测试类别'
        }, {
            field: 'testTime',
            title: '检测时间'
        }

        ]
    });





    //    $("#data").click(function(){
    //
    //        console.log($(".datetime").val());
    //
    //    });
    //    console.log($(".datetime").val());
</script>

</body>
</html>
